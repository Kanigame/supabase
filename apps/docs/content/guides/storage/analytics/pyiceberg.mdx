---
title: 'Using PyIceberg with Analytics Buckets'
---

<Admonition type="warning">
  This feature is in **Private Alpha**. API stability and backward compatibility are not guaranteed
  at this stage.
</Admonition>

PyIceberg is a Python client for Apache Iceberg, facilitating interaction with Iceberg Buckets.

**Installation**

```bash
pip install pyiceberg pyarrow
```

**Example Usage**

Here's a comprehensive example using PyIceberg with clearly separated configuration:

```python
from pyiceberg.catalog import load_catalog
import pyarrow as pa
import datetime

# Supabase project ref
PROJECT_REF = "<your-supabase-instance>"

# Configuration for Iceberg REST Catalog
WAREHOUSE = "your-analytic-bucket-name"
TOKEN = "SERVICE_KEY"

# Configuration for S3-Compatible Storage
S3_ACCESS_KEY = "KEY"
S3_SECRET_KEY = "SECRET"
S3_REGION = "PROJECT_REGION"

S3_ENDPOINT = f"https://{PROJECT_REF}.supabase.co/storage/v1/s3"
CATALOG_URI = f"https://{PROJECT_REF}.supabase.co/storage/v1/iceberg"

# Load the Iceberg catalog
catalog = load_catalog(
    "analytics-bucket",
    type="rest",
    warehouse=WAREHOUSE,
    uri=CATALOG_URI,
    token=TOKEN,
    **{
        "py-io-impl": "pyiceberg.io.pyarrow.PyArrowFileIO",
        "s3.endpoint": S3_ENDPOINT,
        "s3.access-key-id": S3_ACCESS_KEY,
        "s3.secret-access-key": S3_SECRET_KEY,
        "s3.region": S3_REGION,
        "s3.force-virtual-addressing": False,
    },
)

# Create namespace if it doesn't exist
catalog.create_namespace_if_not_exists("default")

# Define schema for your Iceberg table
schema = pa.schema([
    pa.field("event_id", pa.int64()),
    pa.field("event_name", pa.string()),
    pa.field("event_timestamp", pa.timestamp("ms")),
])

# Create table (if it doesn't exist already)
table = catalog.create_table_if_not_exists(("default", "events"), schema=schema)

# Generate and insert sample data
current_time = datetime.datetime.now()
data = pa.table({
    "event_id": [1, 2, 3],
    "event_name": ["login", "logout", "purchase"],
    "event_timestamp": [current_time, current_time, current_time],
})

# Append data to the Iceberg table
table.append(data)

# Scan table and print data as pandas DataFrame
df = table.scan().to_pandas()
print(df)
```
